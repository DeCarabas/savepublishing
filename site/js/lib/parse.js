// Generated by CoffeeScript 1.3.3
(function() {
  var ELEMENT_NODE, TEXT_NODE, blockEls, blocks, entities, textNodes, textuals, unwrap, wrap,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  TEXT_NODE = 3;

  ELEMENT_NODE = 1;

  console.log('called parse.js');

  String.prototype.shrink = function() {
    return this;
  };

  entities = /[&\"><]/g;

  String.prototype.entities = function() {
    var replace;
    replace = function(char) {
      switch (char) {
        case '&':
          return '&amp;';
        case '"':
          return '&quot;';
        case '>':
          return '&gt;';
        case '<':
          return '&lt;';
      }
    };
    return this.replace(entities, function(a) {
      return replace(a);
    });
  };

  Node.prototype.isEmpty = function() {
    if (this.isText()) {
      return this.nodeValue.clean().length === 0;
    } else {
      return false;
    }
  };

  String.prototype.clean = function() {
    var str;
    str = this.replace(/\s+/g, ' ').replace(/\n+/g, ' ');
    str = str.replace(/^\s*$/, '');
    str = str.entities();
    return str;
  };

  Element.prototype.display = function() {
    return $(this).css('display');
  };

  blocks = ['block', 'inline-block', 'table-cell', 'table-caption', 'list-item', 'none'];

  blockEls = ['H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'BODY', 'BR'];

  textuals = ['SPAN', 'A', 'EM', 'B', 'STRONG', 'I'];

  Element.prototype.isBlockLike = function() {
    var _ref, _ref1;
    return (_ref = this.display(), __indexOf.call(blocks, _ref) >= 0) || (_ref1 = this.nodeName, __indexOf.call(blockEls, _ref1) >= 0);
  };

  Element.prototype.toText = function() {
    var n, text;
    text = $(this).text();
    n = this.nodeName;
    if (n === 'B' || n === 'STRONG') {
      "*" + text + "*";
    } else if (n === 'EM' || n === 'I') {
      "_" + text + "_";
    }
    return text;
  };

  Object.prototype.isBlockLike = function() {
    return false;
  };

  Array.prototype.concatenate = function() {
    if (this.length > 0) {
      return "<span class=\"socialtext\">[" + (this.join(" ")) + "]</span>";
    }
  };

  Node.prototype.append = function(str) {
    return this.nodeValue = this.nodeValue + str;
  };

  Node.prototype.isBlockLike = function() {
    return false;
  };

  Node.prototype.isText = function() {
    return this.nodeType === TEXT_NODE;
  };

  Node.prototype.isTextual = function() {
    var _ref;
    return (this.nodeType === ELEMENT_NODE) && (_ref = this.nodeName, __indexOf.call(textuals, _ref) >= 0);
  };

  Node.prototype.isTextish = function() {
    return this.isText || this.isTextual;
  };

  Node.prototype.isElement = function() {
    var _ref;
    return (this.nodeType === ELEMENT_NODE) && (_ref = this.nodeName, __indexOf.call(textuals, _ref) < 0);
  };

  Node.prototype.isIgnorable = function() {
    return !this || this.nodeType === 8 || /^[\t\n\r ]+$/.test(this.data);
  };

  wrap = function(text) {
    return "<span class=\"socialtext-text\">" + text + "</span>";
  };

  $.fn.dress = function() {
    return this.addClass("socialtext-text");
  };

  textNodes = function(node, array) {
    var nextIsTextish, _ref;
    if (node != null) {
      nextIsTextish = (_ref = node.nextSibling) != null ? _ref.isTextish() : void 0;
      if (node.isTextish()) {
        array.push($(node).text());
      }
      if (nextIsTextish) {
        textNodes(node.nextSibling, array);
      }
      return array.join("");
    }
  };

  unwrap = function(node) {
    var prev, seentext, _i, _len, _ref, _results;
    seentext = false;
    if (node.isElement()) {
      _ref = node.childNodes;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        node = _ref[_i];
        _results.push(unwrap(node));
      }
      return _results;
    } else if (node.isTextish()) {
      prev = node.previousSibling;
      if (!prev && !(prev.isText() || prev.isTextual())) {
        console.log(textNodes(node, []));
      }
      return seentext = true;
    }
  };

  $(function() {
    return unwrap(document.body);
  });

}).call(this);
